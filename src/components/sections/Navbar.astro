---
import Button from "../ui/Button.astro";
import {
  ChevronDown,
  Palette,
  Monitor,
  Megaphone,
  PenTool,
  Video,
  Smartphone,
  Menu,
  X,
  ArrowUpLeft,
  BookOpen,
} from "lucide-react";

// Services list for dropdown
const servicesList = [
  {
    label: "تصميم الهوية البصرية",
    href: "/services#branding",
    icon: Palette,
    desc: "شعارات، هوية متكاملة",
  },
  {
    label: "تصميم وتطوير المواقع",
    href: "/services#web",
    icon: Monitor,
    desc: "متاجر، مواقع شركات",
  },
  {
    label: "التسويق الرقمي",
    href: "/services#marketing",
    icon: Megaphone,
    desc: "SEO، إدارة حملات",
  },
  {
    label: "تصميم الجرافيك",
    href: "/services#graphic",
    icon: PenTool,
    desc: "سوشيال ميديا، مطبوعات",
  },
  {
    label: "صناعة المحتوى",
    href: "/services#content",
    icon: Video,
    desc: "كتابة، موشن جرافيك",
  },
  {
    label: "تطبيقات الموبايل",
    href: "/services#mobile",
    icon: Smartphone,
    desc: "iOS, Android, Native",
  },
];
---

<header
  id="main-header"
  class="fixed top-0 left-0 right-0 z-[100] px-4 py-4 transition-all duration-300"
>
  <nav
    id="nav-container"
    class="mx-auto max-w-7xl flex items-center justify-between px-6 py-3 rounded-2xl border border-white/20 bg-surface/80 backdrop-blur-xl shadow-sm transition-all duration-500 relative z-[101]"
  >
    {/* Logo */}
    <a
      href="/"
      class="text-2xl font-black tracking-tighter text-foreground group"
    >
      إراتيك<span class="text-primary group-hover:animate-pulse">.</span>
    </a>

    {/* Desktop Navigation */}
    <div class="hidden lg:flex items-center gap-1">
      <a
        href="/"
        class="px-4 py-2 text-sm font-bold text-muted hover:text-primary transition-colors"
      >
        الرئيسية
      </a>

      {/* Services Dropdown */}
      <div class="group relative">
        <button
          class="flex items-center gap-1 px-4 py-2 text-sm font-bold text-muted group-hover:text-primary transition-colors cursor-default"
        >
          <span>خدماتنا</span>
          <ChevronDown
            className="w-4 h-4 transition-transform group-hover:rotate-180"
          />
        </button>

        {/* Dropdown Panel */}
        <div
          class="absolute top-full left-1/2 -translate-x-1/2 mt-6 w-[640px] opacity-0 invisible translate-y-4 group-hover:opacity-100 group-hover:visible group-hover:translate-y-0 transition-all duration-300 ease-out pt-4"
        >
          <div
            class="bg-surface rounded-[2rem] border border-foreground/5 shadow-2xl p-6 grid grid-cols-2 gap-3 overflow-hidden relative"
          >
            {
              servicesList.map((service) => (
                <a
                  href={service.href}
                  class="flex items-center gap-4 p-3 rounded-xl hover:bg-subtle transition-colors group/item"
                >
                  <div class="w-12 h-12 shrink-0 rounded-2xl bg-subtle text-primary flex items-center justify-center group-hover/item:bg-primary group-hover/item:text-white transition-all">
                    <service.icon className="w-6 h-6" />
                  </div>
                  <div>
                    <div class="text-sm font-bold text-foreground mb-0.5">
                      {service.label}
                    </div>
                    <div class="text-xs text-muted font-medium">
                      {service.desc}
                    </div>
                  </div>
                </a>
              ))
            }
          </div>
          <div class="absolute -top-4 left-0 w-full h-4 bg-transparent"></div>
        </div>
      </div>

      <a
        href="/blog"
        class="px-4 py-2 text-sm font-bold text-muted hover:text-primary transition-colors"
      >
        المدونة
      </a>
      <a
        href="/about"
        class="px-4 py-2 text-sm font-bold text-muted hover:text-primary transition-colors"
      >
        من نحن
      </a>
      <a
        href="/contact"
        class="px-4 py-2 text-sm font-bold text-muted hover:text-primary transition-colors"
      >
        تواصل معنا
      </a>
    </div>

    {/* CTA Button + Mobile Toggle */}
    <div class="flex items-center gap-3">
      <a
        href="/contact"
        class="hidden md:flex items-center gap-2 px-5 py-2.5 bg-primary text-inverse rounded-xl text-sm font-bold shadow-lg hover:-translate-y-0.5 transition-all"
      >
        <span>اطلب عرض سعر</span>
      </a>

      <button
        id="mobile-toggle"
        class="lg:hidden p-2.5 bg-surface border border-foreground/10 rounded-xl text-foreground hover:bg-subtle transition-colors shadow-sm"
      >
        <Menu className="w-6 h-6" />
      </button>
    </div>
  </nav>

  {/* MOBILE MENU */}
  <div
    id="mobile-menu"
    class="fixed inset-0 z-[200] bg-background flex flex-col opacity-0 invisible transition-all duration-300 translate-y-4"
  >
    <div
      class="px-6 py-5 flex items-center justify-between border-b border-foreground/5 bg-surface/80 backdrop-blur-md sticky top-0 z-10"
    >
      <span class="text-2xl font-black text-foreground">القائمة</span>
      <button
        id="mobile-close"
        class="p-2.5 bg-subtle rounded-xl text-foreground hover:bg-red-50 hover:text-red-500 transition-colors"
      >
        <X className="w-6 h-6" />
      </button>
    </div>

    <div class="flex-1 overflow-y-auto px-6 py-8 pb-32">
      <div class="space-y-6">
        <a
          href="/"
          class="text-3xl font-black text-foreground flex items-center justify-between group"
        >
          الرئيسية
          <ArrowUpLeft
            className="w-6 h-6 text-muted group-active:text-primary"
          />
        </a>

        <a
          href="/blog"
          class="text-3xl font-black text-foreground flex items-center justify-between group"
        >
          المدونة
          <BookOpen className="w-6 h-6 text-muted group-active:text-primary" />
        </a>

        <a
          href="/about"
          class="text-3xl font-black text-foreground flex items-center justify-between group"
        >
          من نحن
          <ArrowUpLeft
            className="w-6 h-6 text-muted group-active:text-primary"
          />
        </a>

        <a
          href="/contact"
          class="text-3xl font-black text-foreground flex items-center justify-between group"
        >
          تواصل معنا
          <ArrowUpLeft
            className="w-6 h-6 text-muted group-active:text-primary"
          />
        </a>

        <div class="pt-6 border-t border-foreground/10">
          <h3 class="text-lg font-black text-foreground mb-4">خدماتنا</h3>
          <div class="grid grid-cols-1 gap-3">
            {
              servicesList.map((service) => (
                <a
                  href={service.href}
                  class="flex items-center gap-4 p-4 rounded-2xl bg-subtle active:bg-primary/10 transition-colors"
                >
                  <div class="w-12 h-12 rounded-xl bg-surface text-primary flex items-center justify-center shadow-sm">
                    <service.icon className="w-6 h-6" />
                  </div>
                  <div>
                    <div class="text-lg font-bold text-foreground">
                      {service.label}
                    </div>
                    <div class="text-xs text-muted font-medium">
                      {service.desc}
                    </div>
                  </div>
                </a>
              ))
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  const navContainer = document.getElementById("nav-container");
  const mainHeader = document.getElementById("main-header");
  const mobileMenu = document.getElementById("mobile-menu");
  const mobileToggle = document.getElementById("mobile-toggle");
  const mobileClose = document.getElementById("mobile-close");

  // Scroll Logic
  window.addEventListener("scroll", () => {
    if (window.scrollY > 20) {
      navContainer?.classList.replace("max-w-7xl", "max-w-5xl");
      navContainer?.classList.add("shadow-md", "bg-white/95");
      mainHeader?.classList.replace("py-4", "py-2");
    } else {
      navContainer?.classList.replace("max-w-5xl", "max-w-7xl");
      navContainer?.classList.remove("shadow-md", "bg-white/95");
      mainHeader?.classList.replace("py-2", "py-4");
    }
  });

  // Mobile Menu Logic
  function toggleMenu(show: boolean) {
    if (show) {
      mobileMenu?.classList.remove("opacity-0", "invisible", "translate-y-4");
      document.body.style.overflow = "hidden";
    } else {
      mobileMenu?.classList.add("opacity-0", "invisible", "translate-y-4");
      document.body.style.overflow = "";
    }
  }

  mobileToggle?.addEventListener("click", () => toggleMenu(true));
  mobileClose?.addEventListener("click", () => toggleMenu(false));

  // Close menu when clicking internal links
  document.querySelectorAll("#mobile-menu a").forEach((link) => {
    link.addEventListener("click", () => toggleMenu(false));
  });
</script>
